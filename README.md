# åå…‰è¡£æ£€æµ‹ç³»ç»Ÿ (Reflective Vest Detection)

åŸºäº YOLO11 çš„åå…‰è¡£ç›®æ ‡æ£€æµ‹é¡¹ç›®

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®ä½¿ç”¨ YOLO11m æ¨¡å‹è®­ç»ƒåå…‰è¡£æ£€æµ‹å™¨,å¯ç”¨äºå·¥åœ°å®‰å…¨ç›‘æ§ã€äººå‘˜ç©¿æˆ´æ£€æµ‹ç­‰åœºæ™¯ã€‚

### ä¸»è¦ç‰¹æ€§

- åŸºäº YOLO11m æ¨¡å‹,æ£€æµ‹é€Ÿåº¦å¿«ã€ç²¾åº¦é«˜
- æ”¯æŒå•é˜¶æ®µåå…‰è¡£æ£€æµ‹
- æ”¯æŒä¸¤é˜¶æ®µæ£€æµ‹(äººå‘˜+åå…‰è¡£ç©¿æˆ´åˆ¤å®š)
- å®Œæ•´çš„è®­ç»ƒã€è¯„ä¼°å’Œæ¨ç†æµç¨‹
- æ”¯æŒå¤šGPUè®­ç»ƒ

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python >= 3.8
- CUDA >= 11.0 (GPUè®­ç»ƒ)
- 8GB+ GPUæ˜¾å­˜(æ¨è)

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–:
- ultralytics >= 8.0.0
- torch >= 2.0.0
- opencv-python
- pyyaml

### ä¸‹è½½æ•°æ®é›†å’Œæ¨¡å‹

**ç™¾åº¦ç½‘ç›˜ä¸‹è½½é“¾æ¥**: `[è¯·åœ¨æ­¤å¤„æ·»åŠ ä½ çš„ç™¾åº¦ç½‘ç›˜åˆ†äº«é“¾æ¥]`

**æå–ç **: `xxxx`

ä¸‹è½½åæ–‡ä»¶æ”¾ç½®:
```
fgy/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ vest_merged/          # è§£å‹æ•°æ®é›†åˆ°æ­¤å¤„
â”‚       â”œâ”€â”€ images/
â”‚       â”‚   â”œâ”€â”€ train/
â”‚       â”‚   â”œâ”€â”€ val/
â”‚       â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ labels/
â”‚           â”œâ”€â”€ train/
â”‚           â”œâ”€â”€ val/
â”‚           â””â”€â”€ test/
â””â”€â”€ models/
    â””â”€â”€ best.pt               # è®­ç»ƒå¥½çš„æœ€ä½³æ¨¡å‹
```

## ä½¿ç”¨è¯´æ˜

### 1. è®­ç»ƒæ¨¡å‹

```bash
python train_yolo11.py
```

é…ç½®æ–‡ä»¶åœ¨ [configs/](configs/) ç›®å½•ä¸‹,å¯ä¿®æ”¹è®­ç»ƒå‚æ•°ã€‚

**å¯ç”¨çš„è®­ç»ƒè„šæœ¬**:
- `train_yolo11.py` - ä¸»è®­ç»ƒè„šæœ¬
- `train_yolo11_stable.py` - ç¨³å®šç‰ˆè®­ç»ƒ
- `train_yolo11_multi_gpu_fixed.py` - å¤šGPUè®­ç»ƒ

### 2. æ¨ç†æ£€æµ‹

#### å•å¼ å›¾ç‰‡æ£€æµ‹
```bash
from ultralytics import YOLO

# åŠ è½½æ¨¡å‹
model = YOLO('models/best.pt')

# æ¨ç†
results = model('path/to/image.jpg')
results[0].show()
```

#### æ‰¹é‡æ£€æµ‹
```bash
python evaluate_test.py
```

### 3. ä¸¤é˜¶æ®µæ£€æµ‹(äººå‘˜ç©¿æˆ´åˆ¤å®š)

æ£€æµ‹äººå‘˜å¹¶åˆ¤æ–­æ˜¯å¦ç©¿æˆ´åå…‰è¡£:

```bash
python two_stage_detection_fixed.py
```

è¾“å‡ºç»“æœ:
- ç»¿è‰²æ¡†: ç©¿æˆ´åå…‰è¡£çš„äººå‘˜
- çº¢è‰²æ¡†: æœªç©¿æˆ´åå…‰è¡£çš„äººå‘˜
- é»„è‰²æ¡†: æ£€æµ‹åˆ°çš„åå…‰è¡£

## é¡¹ç›®ç»“æ„

```
fgy/
â”œâ”€â”€ configs/                  # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml
â”‚   â”œâ”€â”€ config_final.yaml    # æœ€ç»ˆè®­ç»ƒé…ç½®
â”‚   â””â”€â”€ *.yaml               # å…¶ä»–é…ç½®
â”œâ”€â”€ src/                      # æºä»£ç 
â”‚   â”œâ”€â”€ data/                # æ•°æ®åŠ è½½
â”‚   â”œâ”€â”€ models/              # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ train/               # è®­ç»ƒæ¨¡å—
â”‚   â”œâ”€â”€ eval/                # è¯„ä¼°æ¨¡å—
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ data/                     # æ•°æ®é›†ç›®å½•(ä»ç™¾åº¦ç½‘ç›˜ä¸‹è½½)
â”‚   â””â”€â”€ vest_merged/         # åˆå¹¶æ•°æ®é›†
â”‚       â”œâ”€â”€ images/          # å›¾ç‰‡
â”‚       â””â”€â”€ labels/          # æ ‡æ³¨
â”œâ”€â”€ models/                   # æ¨¡å‹æƒé‡(ä»ç™¾åº¦ç½‘ç›˜ä¸‹è½½)
â”‚   â””â”€â”€ best.pt              # æœ€ä½³æ¨¡å‹
â”œâ”€â”€ scripts/                  # å·¥å…·è„šæœ¬
â”œâ”€â”€ logs/                     # è®­ç»ƒæ—¥å¿—
â”œâ”€â”€ results/                  # ç»“æœè¾“å‡º
â”œâ”€â”€ train_yolo11.py          # ä¸»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ train_yolo11_stable.py   # ç¨³å®šç‰ˆè®­ç»ƒ
â”œâ”€â”€ evaluate_test.py         # è¯„ä¼°è„šæœ¬
â”œâ”€â”€ two_stage_detection_fixed.py  # ä¸¤é˜¶æ®µæ£€æµ‹
â”œâ”€â”€ requirements.txt         # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                # æœ¬æ–‡æ¡£
```

## æ•°æ®é›†ä¿¡æ¯

**vest_merged åˆå¹¶æ•°æ®é›†**:
- è®­ç»ƒé›†: 27,414 å¼ å›¾ç‰‡(43,044 ä¸ªæ ‡æ³¨)
- éªŒè¯é›†: 6,794 å¼ å›¾ç‰‡(10,330 ä¸ªæ ‡æ³¨)
- æµ‹è¯•é›†: 9,994 å¼ å›¾ç‰‡(16,078 ä¸ªæ ‡æ³¨)
- ç±»åˆ«: 1 ä¸ª(reflective_vest, class_id=0)
- æ€»è®¡: 44,202 å¼ å›¾ç‰‡,69,452 ä¸ªæ ‡æ³¨

æ•°æ®æ¥æº(6ä¸ªå…¬å¼€æ•°æ®é›†åˆå¹¶):
- vest.v1i.yolov8
- Robot Vest.v3i.yolov8 & v4i.yolov8
- Safety Vest PPE.v1i.yolov8 & v3i.yolov8
- fgy original dataset

### æ•°æ®æ ¼å¼

YOLOæ ¼å¼æ ‡æ³¨æ–‡ä»¶(.txt):
```
class_id center_x center_y width height
```
æ‰€æœ‰åæ ‡å½’ä¸€åŒ–åˆ° [0, 1] èŒƒå›´ã€‚

## æ¨¡å‹æ€§èƒ½

ä½¿ç”¨ YOLO11m åœ¨ vest_merged æ•°æ®é›†ä¸Šè®­ç»ƒ100è½®çš„æ€§èƒ½:

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **Precision** | **97.48%** |
| **Recall** | **96.91%** |
| **mAP@0.5** | **98.95%** |
| **mAP@0.5-0.95** | **90.04%** |
| è®­ç»ƒè½®æ•° | 100 epochs |
| æ¨¡å‹å¤§å° | 110MB |

### è®­ç»ƒæ›²çº¿å’Œç»“æœå¯è§†åŒ–

#### è®­ç»ƒè¿‡ç¨‹æ›²çº¿
è®­ç»ƒ100è½®çš„å®Œæ•´è®­ç»ƒè¿‡ç¨‹ï¼Œå±•ç¤ºlossã€ç²¾åº¦ã€å¬å›ç‡ã€mAPç­‰æŒ‡æ ‡çš„å˜åŒ–ï¼š

![Training Results](assets/training_results/results.png)

#### æ··æ·†çŸ©é˜µ
æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„åˆ†ç±»æ•ˆæœï¼Œå±•ç¤ºåå…‰è¡£æ£€æµ‹çš„å‡†ç¡®æ€§ï¼š

![Confusion Matrix](assets/training_results/confusion_matrix.png)

#### PRæ›²çº¿å’ŒF1æ›²çº¿
Precision-Recallæ›²çº¿å’ŒF1åˆ†æ•°æ›²çº¿ï¼š

<table>
<tr>
<td><img src="assets/training_results/BoxPR_curve.png" alt="PR Curve" width="400"/></td>
<td><img src="assets/training_results/BoxF1_curve.png" alt="F1 Curve" width="400"/></td>
</tr>
</table>

#### æ ‡ç­¾åˆ†å¸ƒ
æ•°æ®é›†ä¸­åå…‰è¡£æ ‡æ³¨çš„åˆ†å¸ƒæƒ…å†µï¼š

![Label Distribution](assets/training_results/labels.jpg)

#### éªŒè¯é›†é¢„æµ‹ç»“æœç¤ºä¾‹
æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„å®é™…æ£€æµ‹æ•ˆæœï¼ˆé»„è‰²æ¡†æ ‡æ³¨åå…‰è¡£ï¼‰ï¼š

![Validation Predictions](assets/training_results/val_batch0_pred.jpg)

> ğŸ’¡ **æç¤º**: æ›´å¤šè®­ç»ƒç»“æœå’Œå¯è§†åŒ–å›¾ç‰‡è¯·ä»ç™¾åº¦ç½‘ç›˜ä¸‹è½½å®Œæ•´çš„ `training_results/` æ–‡ä»¶å¤¹ã€‚

## è®­ç»ƒé…ç½®

æ¨èè®­ç»ƒå‚æ•°(config_final.yaml):
- æ¨¡å‹: yolo11m
- è¾“å…¥å°ºå¯¸: 640x640
- Batch size: 16
- Epochs: 100
- å­¦ä¹ ç‡: 0.01
- ä¼˜åŒ–å™¨: SGD
- æ•°æ®å¢å¼º: é»˜è®¤YOLOå¢å¼º

## å¸¸è§é—®é¢˜

### Q: æ˜¾å­˜ä¸è¶³æ€ä¹ˆåŠ?
A: å‡å°batch_sizeæˆ–ä½¿ç”¨æ›´å°çš„æ¨¡å‹(yolo11n)

### Q: å¦‚ä½•æé«˜æ£€æµ‹ç²¾åº¦?
A:
1. å¢åŠ è®­ç»ƒepochs
2. è°ƒæ•´å­¦ä¹ ç‡
3. ä½¿ç”¨æ›´å¤§æ¨¡å‹(yolo11l/yolo11x)
4. å¢å¼ºæ•°æ®å¢å¼ºç­–ç•¥

### Q: æ”¯æŒå®æ—¶æ£€æµ‹å—?
A: æ”¯æŒ,ä½¿ç”¨yolo11næ¨¡å‹å¯è¾¾åˆ°å®æ—¶æ£€æµ‹é€Ÿåº¦

## æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒè„šæœ¬
- `train_yolo11.py` - ä¸»è®­ç»ƒè„šæœ¬
- `train_yolo11_stable.py` - ç¨³å®šç‰ˆè®­ç»ƒ
- `evaluate_test.py` - æµ‹è¯•é›†è¯„ä¼°
- `two_stage_detection_fixed.py` - ä¸¤é˜¶æ®µæ£€æµ‹(äººå‘˜+ç©¿æˆ´)

### å·¥å…·è„šæœ¬
- `reorganize_dataset.py` - æ•°æ®é›†é‡ç»„
- `check_new_datasets.py` - æ•°æ®é›†æ£€æŸ¥
- `merge_new_datasets.py` - æ•°æ®é›†åˆå¹¶

## æ³¨æ„äº‹é¡¹

1. **class_idå¿…é¡»ä¸º0**: æœ¬é¡¹ç›®åªæ£€æµ‹ä¸€ä¸ªç±»åˆ«(reflective_vest),æ ‡ç­¾æ–‡ä»¶ä¸­å¿…é¡»ä½¿ç”¨class_id=0
2. **æ•°æ®è·¯å¾„**: ç¡®ä¿æ•°æ®é›†è·¯å¾„æ­£ç¡®é…ç½®åœ¨yamlæ–‡ä»¶ä¸­
3. **GPUæ˜¾å­˜**: YOLO11mè‡³å°‘éœ€è¦8GBæ˜¾å­˜,å»ºè®®ä½¿ç”¨16GB+

## å¼•ç”¨

å¦‚æœæœ¬é¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©,è¯·å¼•ç”¨:

```
YOLO11: https://github.com/ultralytics/ultralytics
```

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜,è¯·æäº¤ Issueã€‚

---

## æ›´æ–°æ—¥å¿—

### 2024-01-05
- é¡¹ç›®åˆå§‹åŒ–
- å®Œæˆæ•°æ®é›†æ•´ç†å’Œæ¨¡å‹è®­ç»ƒ
- æ·»åŠ ä¸¤é˜¶æ®µæ£€æµ‹åŠŸèƒ½
